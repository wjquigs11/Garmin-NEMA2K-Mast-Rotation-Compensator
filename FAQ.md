FAQ
1. Why use 2 ESP32s? Why not 2 CAN bus interfaces on a single ESP32?
I tried for months to get a second interface working on the ESP32. The n2k_mcp driver is usually used with Arduino, Teensy and other microcontrollers because they don't have an internal CAN controller. Unfortunately, I could not get the mcp driver to work on the ESP32...it crashed the controller on initialization. And since this is such an incredibly specialized corner case and I don't have the expertise to debug FreeRTOS kernel panics, I didn't have a lot of options. Parsing the raw wind packets wasn't particularly complicated, but I was never able to get the MCP module to read valid data from the second CAN bus. I could see data on the bus, but it was garbage. I probably had some signal problem that again is beyond my ability to debug, and I'm not about to buy an oscilloscope. So I fell back on using a second ESP32 and forwarding the data over a serial link (using UART), which works fine and has the side effect of using the HAT Labs USB bridge code almost unmodified. And since @mairas is a much more qualified developer than I am, this is a good thing.
2. Do I need an external ADC?
RandelO uses an ADS1015 ADC. I decided to use one of the internal ADCs on the ESP32. Either will work.
3. What's the circuit on the Sailor HAT doing?
The Honeywell position sensor runs on 12VDC like other boat electronics. Its output is a variable voltage from 0-12 volts based on the position of the magnet (attached to the mast). However, the ESP32 runs at 3.3V logic level, so trying to convert 12 volts to a digital reading would probably damage the microcontroller. The circuit is a simple voltage divider (https://en.wikipedia.org/wiki/Voltage_divider) to change the input range from 0-12V to 0-3V.
4. Why do I need the GND10?
Garmin purchased Nexus. Nexus instruments use a proprietary protocol called FDX, which runs over RS485. The wire from your masthead wind transducer to the GND10 isn't carrying N2K data, it's carrying FDX data (and on many boats the masthead is too far for an N2K drop cable anyway, hence RS485 which can run a couple kms). The GND10 simply translates FDX packets into N2K. I was able to read and parse FDX data from the USB interface on the GND10, but I was not able to read data from the transducer wire itself. If someone else figures this out, please let me know. I would love to eliminate one more piece of equipment and streamline the system. (Actually, parsing FDX on the ESP32 would allow me to eliminate two microcontrollers, the GND10 as well as the second ESP32, since uncorrected wind data would never be on the N2K bus). Note that you could do all of this on a single Raspberry Pi, since you can wire an ADC to a Pi and the Pi can run the fdxread parsing repo. However, I didn't want a dependency on a full-blown operating system in my instruments.
5. How does the nmea2000 library work?
